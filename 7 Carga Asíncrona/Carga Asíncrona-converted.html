<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>Carga Asíncrona</title>
<!-- Bootstrap CSS -->
<link rel='stylesheet' href='https://use.fontawesome.com/releases/v5.0.13/css/all.css' integrity='sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp' crossorigin='anonymous'>
<link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' />
<style type="text/css">html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:first-child { margin-top: -20px; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="mermaid"] svg, [lang="flow"] svg { max-width: 100%; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root { --side-bar-bg-color: #fafafa; --control-text-color: #777; }
@font-face { font-family: "Open Sans"; font-style: normal; font-weight: normal; src: local("Open Sans Regular"), url("./github/400.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: italic; font-weight: normal; src: local("Open Sans Italic"), url("./github/400i.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: normal; font-weight: bold; src: local("Open Sans Bold"), url("./github/700.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: italic; font-weight: bold; src: local("Open Sans Bold Italic"), url("./github/700i.woff") format("woff"); }
html { font-size: 16px; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 30px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 2px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border: 0px none; overflow: hidden; box-sizing: content-box; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left: 4px solid rgb(223, 226, 229); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
table tr { border-top: 1px solid rgb(223, 226, 229); margin: 0px; padding: 0px; }
table tr:nth-child(2n), thead { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border-width: 1px 1px 0px; border-top-style: solid; border-right-style: solid; border-left-style: solid; border-top-color: rgb(223, 226, 229); border-right-color: rgb(223, 226, 229); border-left-color: rgb(223, 226, 229); border-image: initial; border-bottom-style: initial; border-bottom-color: initial; text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(223, 226, 229); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-lines { padding-left: 4px; }
.code-tooltip { box-shadow: rgba(0, 28, 36, 0.3) 0px 1px 1px 0px; border-top: 1px solid rgb(238, 242, 242); }
.md-fences, code, tt { border: 1px solid rgb(231, 234, 237); background-color: rgb(248, 248, 248); border-radius: 3px; padding: 2px 4px 0px; font-size: 0.9em; }
code { background-color: rgb(243, 244, 244); padding: 0px 2px; }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding: 8px 1em 6px; }
.md-task-list-item > input { margin-left: -1.3em; }
@media print {
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
.md-mathjax-midline { background: rgb(250, 250, 250); }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border-radius: 3px; padding: 2px 0px 0px 4px; font-size: 0.9em; color: inherit; }
.md-tag { color: rgb(167, 167, 167); opacity: 1; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
.sidebar-tabs { border-bottom: none; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { background-color: rgb(250, 250, 250); border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.12); }
header, .context-menu, .megamenu-content, footer { font-family: "Segoe UI", Arial, sans-serif; }
.file-node-content:hover .file-node-icon, .file-node-content:hover .file-node-open-state { visibility: visible; }
.mac-seamless-mode #typora-sidebar { background-color: var(--side-bar-bg-color); }
.md-lang { color: rgb(180, 101, 77); }
.html-for-mac .context-menu { --item-hover-bg-color: #E6F0FE; }
#md-notification .btn { border: 0px; }
.dropdown-menu .divider { border-color: rgb(229, 229, 229); }


.cm-s-inner { background-color: rgb(38, 50, 56); color: rgb(233, 237, 237); }
.cm-s-inner .CodeMirror-gutters { background: rgb(38, 50, 56); color: rgb(83, 127, 126); border: none; }
.cm-s-inner .CodeMirror-guttermarker, .cm-s-inner .CodeMirror-guttermarker-subtle, .cm-s-inner .CodeMirror-linenumber { color: rgb(83, 127, 126); }
.cm-s-inner .CodeMirror-cursor { border-left: 1px solid rgb(248, 248, 240); }
.cm-s-inner div.CodeMirror-selected { background: rgba(255, 255, 255, 0.15); }
.cm-s-inner.CodeMirror-focused div.CodeMirror-selected { background: rgba(255, 255, 255, 0.1); }
.cm-s-inner .CodeMirror-line::selection, .cm-s-inner .CodeMirror-line > span::selection, .cm-s-inner .CodeMirror-line > span > span::selection { background: rgba(255, 255, 255, 0.1); }
.cm-s-inner .CodeMirror-activeline-background { background: rgba(0, 0, 0, 0); }
.cm-s-inner .cm-keyword { color: rgb(199, 146, 234); }
.cm-s-inner .cm-operator { color: rgb(233, 237, 237); }
.cm-s-inner .cm-variable-2 { color: rgb(128, 203, 196); }
.cm-s-inner .cm-variable-3 { color: rgb(130, 177, 255); }
.cm-s-inner .cm-builtin { color: rgb(222, 203, 107); }
.cm-s-inner .cm-atom { color: rgb(247, 118, 105); }
.cm-s-inner .cm-number { color: rgb(247, 118, 105); }
.cm-s-inner .cm-def { color: rgb(233, 237, 237); }
.cm-s-inner .cm-string { color: rgb(195, 232, 141); }
.cm-s-inner .cm-string-2 { color: rgb(128, 203, 196); }
.cm-s-inner .cm-comment { color: rgb(84, 110, 122); }
.cm-s-inner .cm-variable { color: rgb(130, 177, 255); }
.cm-s-inner .cm-tag { color: rgb(128, 203, 196); }
.cm-s-inner .cm-meta { color: rgb(128, 203, 196); }
.cm-s-inner .cm-attribute { color: rgb(255, 203, 107); }
.cm-s-inner .cm-property { color: rgb(128, 203, 174); }
.cm-s-inner .cm-qualifier { color: rgb(222, 203, 107); }
.cm-s-inner .cm-variable-3 { color: rgb(222, 203, 107); }
.cm-s-inner .cm-tag { color: rgb(255, 83, 112); }
.cm-s-inner .cm-error { color: rgb(255, 255, 255); background-color: rgb(236, 95, 103); }
.cm-s-inner .CodeMirror-matchingbracket { text-decoration: underline; color: white !important; }
.md-fences { background-color: rgb(38, 50, 56); color: rgb(233, 237, 237); border: none; }
.md-fences .code-tooltip { background-color: rgb(38, 50, 56); }
.md-diagram-panel { font-family: Arial; font-size: 14px; line-height: 16px; }



 .typora-export li, .typora-export p, .typora-export,  .footnote-line {white-space: normal;} 
</style>
<style type='text/css'>
body.typora-export{
    padding-left: 0;
    padding-right: 0;
    background-color: #f8f8f8;
}
#write-wrapper{
    margin:0px auto;
    margin-top: 80px;
    margin-bottom: 80px;
    max-width: 960px;
    background-color: #fff;
    box-shadow: 0 1px 0 rgba(255, 255, 255, 0),0 0 10px rgba(0, 0, 0, 0.1);
    border: 1px solid #c2c2c2;
    
}
#write, #custom-footer{
    max-width: 100%;
}
.typora-menu  {
    left:0;
    position: fixed;
    top: 0;
    bottom: 0;
    z-index: 10;
    overflow-y: auto;
    width: 300px;
    color: #364149;
    background: #2c2c2c;
    border-right: 1px solid rgba(0,0,0,.07);
    -webkit-transition: left 250ms ease;
    -moz-transition: left 250ms ease;
    -o-transition: left 250ms ease;
    transition: left 250ms ease;
    opacity: .9;
}
.hide-menu .typora-menu{
    left:-300px;
}
.main-content{
    top: 0;
    right: 0;
    bottom: 0;
    overflow-y: auto;
    color: #000;
}
#nav-previous, #nav-next, .top a.toogle{
  -webkit-transition: left 250ms ease;
    -moz-transition: left 250ms ease;
    -o-transition: left 250ms ease;
    transition: left 250ms ease;
    background-color: #2c2c2c;
    opacity: .9;
}
.hide-menu #nav-previous, .hide-menu #nav-next, .hide-menu .top a.toogle{
    left: 0;
}

.hide-menu .main-content{
    margin-left:0px;
}

.md-toc-item a{
    display: block;
    padding: 4px 4px;
    border-bottom: none;
    color: #fafafa;
    background: 0 0;
    position: relative;
    outline: none;
}
.top{
    position: fixed;
    top:0;
    z-index: 4;
    width: 30%;
}

.top a.toogle{
    color:#c2c2c2;
    padding: 8px;
    height: 30px;
    left: 300px;
    position: fixed;
    padding-top:2px;
}
#nav-previous{
    color:#c2c2c2;
    padding: 8px;
    left: 300px;
    position: fixed;
    top: 30px;
    height: 30px;
    padding-top:2px;
}
#nav-next{
    color:#c2c2c2;
    padding: 8px;
    left: 300px;
    position: fixed;
    top: 60px;
    height: 30px;
    padding-top:2px;
}
.top a.toogle:hover, .top a.toogle:focus, #nav-previous:hover, #nav-next:hover, #nav-previous:focus, #nav-next:focus{
    color:rgb(65, 131, 196);
}
.md-toc-content a{
    border-left: 1px solid transparent;
}
.md-toc-content a.active{
    border-left: 1px solid #fafafa;
    color:rgb(65, 131, 196);
}
.md-toc-h1 .md-toc-inner{
    font-weight: inherit;
}
.md-toc-h2 .md-toc-inner{
    margin-left: 0.4em;
}
.md-toc-h3 .md-toc-inner{
    margin-left: 2em;
}
.md-toc-h4 .md-toc-inner{
    margin-left: 3em;
}
.md-toc-h5 .md-toc-inner{
    margin-left: 4em;
}
.md-toc-h6 .md-toc-inner{
    margin-left: 5em;
}

.md-toc-h1 a.md-toc-inner{
    font-size: 1.3rem;
}

.raw-code{
	cursor:pointer;
    position: absolute;
    top: -28px;
    right: 0;
    background-color: rgba(255, 255, 255, .8);
    padding: 2px 4px;
    border: 1px solid #263237;
    color: #263237;
}
.raw-code.hide{
	display:none;
}
.raw-code.show{
	display:inherit;
}</style>
 
</head>
<body class="typora-export">
<div class="typora-container">
  <div class="typora-menu"><div class="md-toc" mdtype="toc">
	<p class="md-toc-content"><span class='md-toc-item md-toc-h1'><a id='anchor-heading-0' title='Carga asíncrona ' class="md-toc-inner active" style="cursor: pointer;" href="#header-n2">Carga asíncrona </a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-1' title='Modal para el producto mediante JSON' class="md-toc-inner" style="cursor: pointer;" href="#header-n4">Modal para el producto mediante JSON</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-2' title='Ruta que nos devuelva la información' class="md-toc-inner" style="cursor: pointer;" href="#header-n21">Ruta que nos devuelva la información</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-3' title='Controlador' class="md-toc-inner" style="cursor: pointer;" href="#header-n30">Controlador</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-4' title='Elemento DOM' class="md-toc-inner" style="cursor: pointer;" href="#header-n36">Elemento DOM</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-5' title='Ventana modal' class="md-toc-inner" style="cursor: pointer;" href="#header-n41">Ventana modal</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-6' title='Modal para el producto mediante dom' class="md-toc-inner" style="cursor: pointer;" href="#header-n62">Modal para el producto mediante dom</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-7' title='Ruta' class="md-toc-inner" style="cursor: pointer;" href="#header-n74">Ruta</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-8' title='Ventana modal' class="md-toc-inner" style="cursor: pointer;" href="#header-n81">Ventana modal</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-9' title='Controlador' class="md-toc-inner" style="cursor: pointer;" href="#header-n89">Controlador</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-10' title='Javascript' class="md-toc-inner" style="cursor: pointer;" href="#header-n92">Javascript</a></span>
<span class='md-toc-item md-toc-h2'><a id='anchor-heading-11' title='Ficha del producto' class="md-toc-inner" style="cursor: pointer;" href="#header-n99">Ficha del producto</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-12' title='Máscara' class="md-toc-inner" style="cursor: pointer;" href="#header-n110">Máscara</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-13' title='Ruta que nos devuelva la información' class="md-toc-inner" style="cursor: pointer;" href="#header-n113">Ruta que nos devuelva la información</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-14' title='Javascript' class="md-toc-inner" style="cursor: pointer;" href="#header-n118">Javascript</a></span>
<span class='md-toc-item md-toc-h4'><a id='anchor-heading-15' title='Cómo funciona pushState' class="md-toc-inner" style="cursor: pointer;" href="#header-n125">Cómo funciona pushState</a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-16' title='Importante  ' class="md-toc-inner" style="cursor: pointer;" href="#header-n143">Importante  </a></span>
<span class='md-toc-item md-toc-h3'><a id='anchor-heading-17' title='Mejoras' class="md-toc-inner" style="cursor: pointer;" href="#header-n148">Mejoras</a></span>
</p></div></div>
  <div class="typora-export  main-content">
  <div class='top'>
    <a class='toogle expanded pull-left js-toolbar-action' aria-label='' href='#'><i class='fas fa-align-justify'></i></a>
    <a class='' href='#' id='nav-previous'><i class='fas fa-angle-double-left'></i></a>
    <a class='' href='#' id='nav-next'><i class='fas fa-angle-double-right'></i></a>
  </div>
    <div id='write-wrapper'>
      <div id='custom-header'>
        <!--put here your custom header -->
       </div>
       <div id="write" class="is-node">
<h1 id="heading-0">
<a name="header-n2" class="md-header-anchor "></a>Carga asíncrona </h1>
<h2 id="heading-1">
<a name="header-n4" class="md-header-anchor "></a>Modal para el producto mediante JSON</h2>
<p>Una de las formas para cargar datos asíncronamente es mediante <strong>ajax</strong> realizando una petición de datos <strong>json</strong> (también es válido para xml)</p>
<p>Una vez traídos los datos json sólo hemos de actualizar el DOM con estos nuevos datos.</p>
<p>Para llevar a cabo este efecto hacen falta tres cosas:</p>
<ol start="">
<li>Una url que nos devuelva la información json</li>
<li>Una ventana modal para mostrar los datos</li>
<li>Código javascript que enlace los eventos.</li>
<li>Un elemento HTML al que añadimos el evento.</li>
</ol>
<p>Vamos a implementar esta funcionalidad en la página del carro.</p>
<p><img src="assets/1548066603229.png" alt="1548066603229" referrerpolicy="no-referrer"></p>
<p><img src="assets/1548072371006.png" alt="1548072371006" referrerpolicy="no-referrer"></p>
<p> </p>
<h3 id="heading-2">
<a name="header-n21" class="md-header-anchor "></a>Ruta que nos devuelva la información</h3>
<p>Hace falta una url con la información del producto. Pero no nos sirve la ruta normal</p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$app</span><span class="cm-operator">-&gt;</span><span class="cm-variable">get</span>(<span class="cm-string">'/producto/{nombre}/{id:[0-9]+}'</span>, <span class="cm-variable">ProductController</span>::<span class="cm-keyword">class</span> . <span class="cm-string">':ficha'</span>)<span class="cm-operator">-&gt;</span><span class="cm-variable">setName</span>(<span class="cm-string">"ficha"</span>);</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 46px;"></div>
</div>
</div></pre>
<p>porque esta carga toda la información del producto (además de los productos relacionados) y nosotros sólo queremos la versión json del mismo.</p>
<p>Así que vamos a añadirle un parámetro opcional a la ruta.</p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$app</span><span class="cm-operator">-&gt;</span><span class="cm-variable">get</span>(<span class="cm-string">'/producto/{nombre}/{id:[0-9]+}[/{format}]'</span>, <span class="cm-variable">ProductController</span>::<span class="cm-keyword">class</span> . <span class="cm-string">':ficha'</span>)<span class="cm-operator">-&gt;</span><span class="cm-variable">setName</span>(<span class="cm-string">"ficha"</span>);</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 46px;"></div>
</div>
</div></pre>
<p>De esta forma, para pedir el producto en formato json, sólo hay que añadir al final de la ruta <code>/json</code></p>
<p>Por ejemplo:</p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">http://127.0.0.1:8080/producto/tulipanes/2/json</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 23px;"></div>
</div>
</div></pre>
<h3 id="heading-3">
<a name="header-n30" class="md-header-anchor "></a>Controlador</h3>
<p>Y modificamos el controlador:</p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="diff" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="diff">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><span><span>​</span>x</span></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> class ProductController</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     protected $container;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@@ -19,10 +20,26 @@ class ProductController</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     public function ficha($request, $response, $args) {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">         extract($args);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+        $format = ($format ?? 'html');</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+        if (($format != "html") &amp;&amp; ($format != 'json')) {</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+            return $response-&gt;withStatus(404)</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+            -&gt;withHeader('Content-Type', 'text/html')</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+            -&gt;write('Page not found');</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+        }</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">         $repositorio = new ProductRepository();</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">         try {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">             $producto = $repositorio-&gt;findById($id);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+            if ($format == 'json'){</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+                $json = json_encode(array("id" =&gt;  $producto-&gt;getId(),</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+                                          "nombre" =&gt; $producto-&gt;getNombre(),</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+                                          "descripcion" =&gt; $producto-&gt;getDescripcion(),</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+                                          "precio" =&gt; number_format($producto-&gt;getPrecio(), 2, ',', ' ') . " €",</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+                                          "url-carro-add" =&gt; $this-&gt;container-&gt;router-&gt;pathFor('cart-add', ['id' =&gt; $producto-&gt;getId()]),</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+                                          "url-carro-update" =&gt; $this-&gt;container-&gt;router-&gt;pathFor('cart-update', ['id' =&gt; $producto-&gt;getId()]),</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+                                          "foto" =&gt; $this-&gt;container-&gt;request-&gt;getUri()-&gt;getBasePath() . Product::RUTA_IMAGENES . '600_' . $producto-&gt;getFoto(),));</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+                return $response-&gt;getBody()-&gt;write($json);</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+            }</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">         }catch(NotFoundException $nfe) {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">             return $response-&gt;write("Producto no encontrado");</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">         }</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 805px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 805px;"></div>
</div>
</div></pre>
<p>Esta es la respuesta del servidor</p>
<p><img src="assets/1547982456967.png" alt="1547982456967" referrerpolicy="no-referrer"></p>
<p>Ahora nos falta enlazarlo para que muestre los datos en una ventana modal.</p>
<h3 id="heading-4">
<a name="header-n36" class="md-header-anchor "></a>Elemento DOM</h3>
<p>Modificamos el carro <code>(cart.part.php)</code> para que muestre un icono nuevo para mostrar la ventana modal:</p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="diff"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="diff">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@@ -23,7 +23,7 @@</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">         foreach ($lineas as $producto) :?&gt;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">       &lt;tr&gt;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">         &lt;th scope="row"&gt;&lt;?=$i++;?&gt;&lt;/th&gt;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-negative">-        &lt;td&gt;&lt;a href="&lt;?=$router-&gt;pathFor('ficha', ['nombre' =&gt;  ProyectoWeb\app\utils\Utils::encodeURI($producto['producto']-&gt;getNombre()), 'id' =&gt; $producto['producto']-&gt;getId()])?&gt;"&gt;&lt;?= $producto['producto']-&gt;getNombre()?&gt;&lt;/a&gt;&lt;/td&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+        &lt;td&gt;&lt;a class="open-modal" href="&lt;?=$router-&gt;pathFor('ficha', ['nombre' =&gt;  ProyectoWeb\app\utils\Utils::encodeURI($producto['producto']-&gt;getNombre()), 'id' =&gt; $producto['producto']-&gt;getId()])?&gt;"&gt;&lt;?= $producto['producto']-&gt;getNombre()?&gt;  &lt;span style='color:#000' class='fa fa-external-link'&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">         &lt;td&gt;&lt;?=$producto['cantidad']?&gt;&lt;/td&gt;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">         &lt;td&gt;&lt;?= number_format($producto['producto']-&gt;getPrecio(), 2, ',', ' ')?&gt; €&lt;/td&gt;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">         &lt;td&gt;&lt;?= number_format($producto['total'], 2, ',', ' ')?&gt;&lt;/td&gt;</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 345px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 345px;"></div>
</div>
</div></pre>
<p>Fijaos que hemos añadido una clase css al enlace (<code>open-modal</code>) y hemos añadido un icono de bootstrap.</p>
<p>Esta clase la usamos como selector css en javascript.</p>
<h3 id="heading-5">
<a name="header-n41" class="md-header-anchor "></a>Ventana modal</h3>
<p>Esta es la plantilla que usamos para mostrar los ventana modal, guardada en <code>partials/modal-json-producto.php</code>. Esta ventana modal es una plantilla en la que cada elemento será sustituido por los datos devueltos pos json.</p>
<p>Por ejemplo, en el elemento DOM seleccionado mediante el selector css <code>.subtitle</code>, pondremos el dato <code>nombre</code> devuelto por JSON.</p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="html" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="html">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">class</span>=<span class="cm-string">"modal fade"</span> <span class="cm-attribute">id</span>=<span class="cm-string">"modalJsonProducto"</span> <span class="cm-attribute">tabindex</span>=<span class="cm-string">"-1"</span> <span class="cm-attribute">role</span>=<span class="cm-string">"dialog"</span> <span class="cm-attribute">aria-labelledby</span>=<span class="cm-string">"myModalLabel"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">class</span>=<span class="cm-string">"modal-dialog modal-lg"</span> <span class="cm-attribute">role</span>=<span class="cm-string">"document"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">class</span>=<span class="cm-string">"modal-content"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">class</span>=<span class="cm-string">"modal-header"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">button</span> <span class="cm-attribute">type</span>=<span class="cm-string">"button"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"close"</span> <span class="cm-attribute">data-dismiss</span>=<span class="cm-string">"modal"</span> <span class="cm-attribute">aria-label</span>=<span class="cm-string">"Close"</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span> <span class="cm-attribute">aria-hidden</span>=<span class="cm-string">"true"</span><span class="cm-tag cm-bracket">&gt;</span>×<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">button</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">h4</span> <span class="cm-attribute">class</span>=<span class="cm-string">"modal-title"</span> <span class="cm-attribute">id</span>=<span class="cm-string">"myModalLabel"</span><span class="cm-tag cm-bracket">&gt;</span>Detalle del producto<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">h4</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">class</span>=<span class="cm-string">"modal-body"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">id</span>=<span class="cm-string">"ficha-producto"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"row"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">          <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">h2</span> <span class="cm-attribute">class</span>=<span class="cm-string">"subtitle"</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">h2</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">          <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">img</span> <span class="cm-attribute">class</span>=<span class="cm-string">"center-block img-responsive img-thumbnail"</span> <span class="cm-attribute">src</span>=<span class="cm-string">""</span> <span class="cm-attribute">alt</span>=<span class="cm-string">""</span> <span class="cm-attribute">title</span>=<span class="cm-string">""</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">          <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">class</span>=<span class="cm-string">"caption"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">p</span> <span class="cm-attribute">class</span>=<span class="cm-string">"lead"</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">          <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">          <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">h4</span> <span class="cm-attribute">class</span>=<span class="cm-string">"pull-right"</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span> <span class="cm-attribute">class</span>=<span class="cm-string">"text text-danger"</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">h4</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 529px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 529px;"></div>
</div>
</div></pre>
<p>Y la incluimos sólo en la vista del carro:</p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">include</span> <span class="cm-atom">__DIR__</span> . <span class="cm-string">"/partials/inicio-doc.part.php"</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">include</span> <span class="cm-atom">__DIR__</span> . <span class="cm-string">"/partials/cart.part.php"</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">include</span> <span class="cm-atom">__DIR__</span> . <span class="cm-string">"/partials/modal-json-producto.part.php"</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">include</span> <span class="cm-atom">__DIR__</span> . <span class="cm-string">"/partials/fin-doc.part.php"</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">?&gt;</span></span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 138px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 138px;"></div>
</div>
</div></pre>
<p>Modificamos <code>CartController</code> para que pase una nueva variable, <code>attachModalInfoJson</code>,  a la plantilla:</p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="diff"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="diff">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@@ -53,7 +53,8 @@ class CartController</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">             $lineas = $items['productos'];</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">             $total = $items['total'];</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">         }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-negative">-        return $this-&gt;container-&gt;renderer-&gt;render($response, "cart.view.php", compact('title', 'header', 'checkout', 'lineas', 'total', 'withCategories'));</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+        $attachModalInfoJson = true;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+        return $this-&gt;container-&gt;renderer-&gt;render($response, "cart.view.php", compact('title', 'header', 'checkout', 'lineas', 'total', 'withCategories', 'attachModalInfoJson'));</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     public function add($request, $response, $args) {</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 299px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 299px;"></div>
</div>
</div></pre>
<p>Y modificamos <code>fin-doc.part.php</code> para que ejecute el javascript que carga los datos:</p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="diff"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="diff">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@@ -29,6 +29,16 @@</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;?php endif ?&gt;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+&lt;?php if(($attachModalInfoJson ?? false)):?&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+&lt;script&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+attachModalInfoJson();</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+&lt;/script&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+&lt;?php endif ?&gt;</span></span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 161px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 161px;"></div>
</div>
</div></pre>
<p>Ya sólo nos queda enlazarlo todo mediante javascript:</p>
<script src="https://gist.github.com/victorponz/a7c54d3fdb5feac49dc55d3206f59bea.js"></script><blockquote>
<p><strong>IMPORTANTE</strong></p>
<p>Ahora cuando mostremos la ventana modal del carro, aparecerá el nombre de la siguiente forma:</p>
<p><img src="assets/1548067527200.png" alt="1548067527200" referrerpolicy="no-referrer"></p>
<p>Para eliminar el icono de <strong>bootstrap</strong>, hay que modificar <code>app.js</code>, cambiando:</p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cartElements</span>.<span class="cm-property">desc</span>.<span class="cm-property">html</span>(<span class="cm-variable">desc</span>.<span class="cm-property">html</span>());</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 23px;"></div>
</div>
</div></pre>
<p>por</p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cartElements</span>.<span class="cm-property">desc</span>.<span class="cm-property">html</span>(<span class="cm-variable">desc</span>.<span class="cm-property">text</span>());</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 23px;"></div>
</div>
</div></pre>
</blockquote>
<p> </p>
<h2 id="heading-6">
<a name="header-n62" class="md-header-anchor "></a>Modal para el producto mediante dom</h2>
<p>Otra forma para mostrar ventanas modales es realizando una petición ajax que nos devuelva un código HTML.</p>
<p>Este HTML se inyecta en el body de la ventana modal.</p>
<p><img src="assets/1548058780268.png" alt="1548058780268" referrerpolicy="no-referrer"></p>
<p>Para llevar a cabo este efecto hacen falta tres cosas:</p>
<ol start="">
<li>Una url que nos devuelva la información en formato HTML</li>
<li>Una ventana modal para mostrar los datos</li>
<li>Código javascript que enlace los eventos.</li>
</ol>
<h3 id="heading-7">
<a name="header-n74" class="md-header-anchor "></a>Ruta</h3>
<p>En este caso nos sirve la misma ruta que antes:</p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$app</span><span class="cm-operator">-&gt;</span><span class="cm-variable">get</span>(<span class="cm-string">'/producto/{nombre}/{id:[0-9]+}[/{format}]'</span>, <span class="cm-variable">ProductController</span>::<span class="cm-keyword">class</span> . <span class="cm-string">':ficha'</span>)<span class="cm-operator">-&gt;</span><span class="cm-variable">setName</span>(<span class="cm-string">"ficha"</span>);</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 46px;"></div>
</div>
</div></pre>
<p>Añadimos el parámetro <code>exclusive</code> a la ruta:</p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">http://127.0.0.1:8080/producto/tulipanes/2/exclusive</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 23px;"></div>
</div>
</div></pre>
<p>Que nos devolverá sólo el HTML de la ficha del producto:</p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="html"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="html">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">id</span>=<span class="cm-string">"ficha-producto"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"row"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">h2</span> <span class="cm-attribute">class</span>=<span class="cm-string">"subtitle"</span><span class="cm-tag cm-bracket">&gt;</span>Tulipanes<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">h2</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">img</span> <span class="cm-attribute">class</span>=<span class="cm-string">"center-block img-responsive img-thumbnail"</span> </span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">       <span class="cm-attribute">src</span>=<span class="cm-string">"/images/600_php6p9520.jpg"</span> </span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">       <span class="cm-attribute">alt</span>=<span class="cm-string">"Tulipanes"</span> </span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">       <span class="cm-attribute">title</span>=<span class="cm-string">"Tulipanes"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">class</span>=<span class="cm-string">"caption"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">p</span> <span class="cm-attribute">class</span>=<span class="cm-string">"lead"</span><span class="cm-tag cm-bracket">&gt;</span>Con su amplia gama de formas y colores, los tulipanes florecen a partir de mediados-finales de primavera y dan un toque de animación a patios y jardines.<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">h4</span> <span class="cm-attribute">class</span>=<span class="cm-string">"pull-right"</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span> <span class="cm-attribute">class</span>=<span class="cm-string">"text text-danger"</span><span class="cm-tag cm-bracket">&gt;</span>12,00 €<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">h4</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">a</span> <span class="cm-attribute">href</span>=<span class="cm-string">"/cart/add/2"</span> <span class="cm-attribute">data-href-update</span>=<span class="cm-string">'/cart/update/2'</span> <span class="cm-attribute">class</span>=<span class="cm-string">"btn btn-danger"</span><span class="cm-tag cm-bracket">&gt;</span>Comprar<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">a</span><span class="cm-tag cm-bracket">&gt;</span>  </span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 345px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 345px;"></div>
</div>
</div></pre>
<h3 id="heading-8">
<a name="header-n81" class="md-header-anchor "></a>Ventana modal</h3>
<p>Esta es la plantilla para esta ventana modal, <code>modal-dom-producto.part.php</code>:</p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="html"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="html">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">class</span>=<span class="cm-string">"modal fade"</span> <span class="cm-attribute">id</span>=<span class="cm-string">"modalDetalleProducto"</span> <span class="cm-attribute">tabindex</span>=<span class="cm-string">"-1"</span> <span class="cm-attribute">role</span>=<span class="cm-string">"dialog"</span> <span class="cm-attribute">aria-labelledby</span>=<span class="cm-string">"myModalLabel"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">class</span>=<span class="cm-string">"modal-dialog modal-lg"</span> <span class="cm-attribute">role</span>=<span class="cm-string">"document"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">class</span>=<span class="cm-string">"modal-content"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">class</span>=<span class="cm-string">"modal-header"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">button</span> <span class="cm-attribute">type</span>=<span class="cm-string">"button"</span> <span class="cm-attribute">class</span>=<span class="cm-string">"close"</span> <span class="cm-attribute">data-dismiss</span>=<span class="cm-string">"modal"</span> <span class="cm-attribute">aria-label</span>=<span class="cm-string">"Close"</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">span</span> <span class="cm-attribute">aria-hidden</span>=<span class="cm-string">"true"</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-atom">&amp;times;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">button</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">h4</span> <span class="cm-attribute">class</span>=<span class="cm-string">"modal-title"</span> <span class="cm-attribute">id</span>=<span class="cm-string">"myModalLabel"</span><span class="cm-tag cm-bracket">&gt;</span>Detalle del producto<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">h4</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">class</span>=<span class="cm-string">"modal-body"</span> <span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">id</span>=<span class="cm-string">'data-container'</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 345px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 345px;"></div>
</div>
</div></pre>
<p>Cuando responda la petición JSON, inyectaremos el HTML devuelto en el elemento <code>data-container</code></p>
<p>Añadimos un icono para mostrar la ventana modal, en <code>thumbnail-producto.part.php</code>, igual que hicimos en <code>cart.part.php</code></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php+HTML"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php+html">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">a</span> <span class="cm-attribute">class</span>=<span class="cm-string">'open-modal'</span> <span class="cm-attribute">href</span>=<span class="cm-string">'</span><span class="cm-meta">&lt;?</span><span class="cm-operator">=</span><span class="cm-variable-2">$router</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pathFor</span>(<span class="cm-string">'ficha'</span>, [<span class="cm-string">'nombre'</span> <span class="cm-operator">=&gt;</span>  <span class="cm-variable">ProyectoWeb\app\utils\Utils</span>::<span class="cm-variable">encodeURI</span>(<span class="cm-variable-2">$producto</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getNombre</span>()), <span class="cm-string">'id'</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">$producto</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getId</span>()])<span class="cm-meta">?&gt;</span><span class="cm-string">'</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-meta">&lt;?</span><span class="cm-operator">=</span> <span class="cm-variable-2">$producto</span><span class="cm-operator">-&gt;</span><span class="cm-variable">getNombre</span>()<span class="cm-meta">?&gt;</span> <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">span</span> <span class="cm-attribute">style</span>=<span class="cm-string">'color:#000'</span> <span class="cm-attribute">class</span>=<span class="cm-string">'fa fa-external-link'</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">a</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 92px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 92px;"></div>
</div>
</div></pre>
<p>Modificamos la vista <code>index.view.php</code>, para incluir el partial:</p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">include</span> <span class="cm-atom">__DIR__</span> . <span class="cm-string">"/partials/inicio-doc.part.php"</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">include</span> <span class="cm-atom">__DIR__</span> . <span class="cm-string">"/partials/carrusel.part.php"</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">include</span> <span class="cm-atom">__DIR__</span> . <span class="cm-string">"/partials/destacados.part.php"</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">include</span> <span class="cm-atom">__DIR__</span> . <span class="cm-string">"/partials/novedades.part.php"</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">include</span> <span class="cm-atom">__DIR__</span> . <span class="cm-string">"/partials/modal-carro.part.php"</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">include</span> <span class="cm-atom">__DIR__</span> . <span class="cm-string">"/partials/modal-dom-producto.part.php"</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">include</span> <span class="cm-atom">__DIR__</span> . <span class="cm-string">"/partials/mask.part.php"</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">include</span> <span class="cm-atom">__DIR__</span> . <span class="cm-string">"/partials/fin-doc.part.php"</span>;</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">?&gt;</span></span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 230px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 230px;"></div>
</div>
</div></pre>
<h3 id="heading-9">
<a name="header-n89" class="md-header-anchor "></a>Controlador</h3>
<p>Modificamos <code>ProductController::ficha</code></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="diff" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="diff">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">     public function ficha($request, $response, $args) {</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">         extract($args);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">         $format = ($format ?? 'html');</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-negative">-        if (($format != "html") &amp;&amp; ($format != 'json')) {</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+        if (($format != "html") &amp;&amp; ($format != 'json') &amp;&amp; ($format != 'exclusive')) {</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">             return $response-&gt;withStatus(404)</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">             -&gt;withHeader('Content-Type', 'text/html')</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">             -&gt;write('Page not found');</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@@ -39,6 +39,8 @@ class ProductController</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                                           "url_carro_update" =&gt; $this-&gt;container-&gt;router-&gt;pathFor('cart-update', ['id' =&gt; $producto-&gt;getId()]),</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                                           "foto" =&gt; $this-&gt;container-&gt;request-&gt;getUri()-&gt;getBasePath() . Product::RUTA_IMAGENES . '600_' . $producto-&gt;getFoto(),));</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                 return $response-&gt;getBody()-&gt;write($json);</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+            } else if ($format == 'exclusive') {</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+                return $this-&gt;container-&gt;renderer-&gt;render($response, "partials/ficha.part.php", compact('producto'));</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">             }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">         }catch(NotFoundException $nfe) {</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">             return $response-&gt;write("Producto no encontrado");</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@@ -53,7 +55,8 @@ class ProductController</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">             $this-&gt;co</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 506px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 506px;"></div>
</div>
</div></pre>
<h3 id="heading-10">
<a name="header-n92" class="md-header-anchor "></a>Javascript</h3>
<p>Ya sólo nos falta enlazarlo todo con javascript:</p>
<script src="https://gist.github.com/victorponz/dfa678f0c415ffd88900669e776faccc.js"></script><p>Modificamos <code>PageController</code> para que le indique a la vista que llame a la función javascript <code>attachModalInfo</code></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="diff"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="diff">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">         }else{</span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">             $this-&gt;container-&gt;logger-&gt;addInfo('Cache hit: categorias');</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">         }</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-negative">-</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-negative">-        return $this-&gt;container-&gt;renderer-&gt;render($response, "index.view.php", compact('title', 'categorias', 'categoriasCached', 'carrusel', 'destacados', 'novedades'));</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+        $attachModalInfo = true;</span></span></pre>
<div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-positive">+        return $this-&gt;container-&gt;renderer-&gt;render($response, "index.view.php", compact('title', 'categorias', 'categoriasCached', 'carrusel', 'destacados', 'novedades', 'attachModalInfo'));</span></span></pre></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 299px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 299px;"></div>
</div>
</div></pre>
<p>Y modificamos <code>fin-doc.part.php</code>, para que llame a la función <code>attachModalInfo</code></p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded md-focus" lang="php"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 353px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span> <span class="cm-keyword">if</span>((<span class="cm-variable-2">$attachModalInfo</span> <span class="cm-operator">??</span> <span class="cm-atom">false</span>)):<span class="cm-operator">?&gt;</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;</span><span class="cm-variable">script</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">attachModalInfo</span>();</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;/</span><span class="cm-variable">script</span><span class="cm-operator">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;?</span><span class="cm-variable">php</span> <span class="cm-keyword">endif</span> <span class="cm-operator">?&gt;</span></span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 115px;"></div>
</div>
</div></pre>
<h2 id="heading-11">
<a name="header-n99" class="md-header-anchor "></a>Ficha del producto</h2>
<p>Vamos a usar la técnica de carga asíncrona por JSON en la página de información de producto al hacer clic en cualquier producto relacionado.</p>
<p><img src="assets/json1.png" alt="" referrerpolicy="no-referrer"></p>
<p>Para llevar a cabo este efecto hacen falta tres cosas:</p>
<ol start="">
<li>Una máscara para informar al usuario de que estamos cargando datos</li>
<li>Una url que nos devuelva la información json</li>
<li>Código javascript que enlace los eventos.</li>
</ol>
<h3 id="heading-12">
<a name="header-n110" class="md-header-anchor "></a>Máscara</h3>
<p>Esta máscara ya debe estar creada en <code>partials/mask.part.php</code> porque la usamos para actualizar el carro.</p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="html"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="html">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation" style="">
<div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">id</span>=<span class="cm-string">"mask"</span> <span class="cm-attribute">style</span>=<span class="cm-string">"position: fixed; width: 100%; height: 100%; top: 0px; left: 0px; z-index: 1040;</span></span></pre>
</div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-string">background-color: white;  opacity: .9; display:none"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">class</span>=<span class="cm-string">"alert alert-info"</span> <span class="cm-attribute">role</span>=<span class="cm-string">"alert"</span> <span class="cm-attribute">style</span>=<span class="cm-string">'position: absolute;  top: 30%;  left: 50%;  transform: translate(-30%, -50%);'</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">img</span> <span class="cm-attribute">src</span>=<span class="cm-string">'&lt;?php echo CSSPATH;?&gt;/loading_animation.gif'</span><span class="cm-tag cm-bracket">&gt;</span> Cargando ...</span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
</div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 184px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 184px;"></div>
</div>
</div></pre>
<h3 id="heading-13">
<a name="header-n113" class="md-header-anchor "></a>Ruta que nos devuelva la información</h3>
<p>La segunda parte es una url con la información del producto. Esta ruta es la misma que hemos usado previamente en el ejemplo de la página del carro.</p>
<pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="php"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="php">
<div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div>
<div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div>
<div class="CodeMirror-gutter-filler" cm-not-content="true"></div>
<div class="CodeMirror-scroll" tabindex="-1">
<div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;">
<div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div>
<div class="CodeMirror-measure"></div>
<div style="position: relative; z-index: 1;"></div>
<div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;">
<div class="CodeMirror-activeline-background CodeMirror-linebackground"></div>
<div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div>
<pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$app</span><span class="cm-operator">-&gt;</span><span class="cm-variable">get</span>(<span class="cm-string">'/producto/{nombre}/{id:[0-9]+}[/{format}]'</span>, <span class="cm-variable">ProductController</span>::<span class="cm-keyword">class</span> . <span class="cm-string">':ficha'</span>)<span class="cm-operator">-&gt;</span><span class="cm-variable">setName</span>(<span class="cm-string">"ficha"</span>);</span></pre>
</div></div>
</div></div></div></div>
<div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 46px;"></div>
<div class="CodeMirror-gutters" style="display: none; height: 46px;"></div>
</div>
</div></pre>
<p>De esta forma, para pedir el producto en formato json, sólo hay que añadir al final de la ruta <code>/json</code></p>
<p>El controlador es el mismo también.</p>
<h3 id="heading-14">
<a name="header-n118" class="md-header-anchor "></a>Javascript</h3>
<p>Ahora ya solo falta enlazar los elementos dom para que al hacer clic en el thumbnail del producto, cargue los datos asíncronamente.  </p>
<p>Siempre que carguemos datos asíncronamente, nos hemos de plantear si nos interesa mantener el historial de la página.  </p>
<p>Cuando cargamos datos por ajax, el <em>history</em> del navegador no se modifica. Esto tiene graves implicaciones de usabilidad. Imaginad que cargo la primera página de producto y luego voy haciendo clic otro producto. Como no se ha cambiado la url, cuando el usuario haga clic en el botón anterior del navegador, no volverá al producto anterior sino a la página en la que estuviera antes de visitar por primera vez la página de productos. Además, pensad que un usuario ha visitado el producto 2 y decide guardarse la url en favoritos o compartirla con alguien: realmente no se ha guardado el enlace al producto 2, sino al primer producto!!  </p>
<p>Para comprobar este efecto indeseable, comentad la línea que hace <code>pushState</code>.  </p>
<p>Para corregir este defecto, se usa el método pushState del navegador (sólo es válido en navegadores compatibles con HTML5).</p>
<p>Además, <strong>no pongáis nunca en HTML la url con /json</strong> porque cuando Google rastree nuestra página seguirá este enlace y no queremos que lo haga con ese estado. Por tanto, es importante hacerlo siempre en javascript.</p>
<h4 id="heading-15">
<a name="header-n125" class="md-header-anchor "></a>Cómo funciona pushState</h4>
<p>El navegador mantiene una estructura para guardar el history. Cada vez que llamamos a <code>pushState(data, title, url)</code> almacena estos datos. Por ejemplo, si llamamos a pushState("datos1", null, pagina1.php) y pushState("datos2", null, pagina2.php), este será el contenido de dicha estructura del navegador.</p>
<figure><table>
<thead><tr>
<th style="text-align:left;">data</th>
<th style="text-align:left;">title</th>
<th style="text-align:left;">url</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">datos1</td>
<td style="text-align:left;">null</td>
<td style="text-align:left;">pagina1.php</td>
</tr>
<tr>
<td style="text-align:left;">datos2</td>
<td style="text-align:left;">null</td>
<td style="text-align:left;">pagina2.php</td>
</tr>
</tbody>
</table></figure><p>Cuando el usuario visita una de estas páginas mediante los botones del historial <code>Siguiente</code> o <code>Anterior</code>, el navegador llama al evento <code>popstate</code> y le pasa como parámetro los datos guardados para esa url.<br>Por ejemplo, cuando el usuario visite con los botones del historial la página <code>pagina2.php</code>, el evento contendrá el valor <code>"datos2"</code> en el campo <code>state</code>. Si por el contrario, visita la página <code>pagina1.php,</code> el evento contendrá el valor <code>"datos1"</code></p>
<p>Este javascript debéis añadirlo a <code>app.js</code></p>
<script src="https://gist.github.com/victorponz/348cef720a388be5f6504c2e29d973c9.js"></script><h3 id="heading-16">
<a name="header-n143" class="md-header-anchor "></a><strong>Importante</strong>  </h3>
<p>Este código javascript debe ir después de la carga de jQuery y de bootstrap, es decir en  <code>fin-doc.part.php</code><br>Pero si lo ponemos tal cual en este archivo, se cargará en todas las páginas y no queremos que esto ocurra.  Así que nos definimos una nueva variable en el controlador ProductController:</p>
<pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="php" contenteditable="false" cid="n145" mdtype="fences">$loadProductoJson = true;
return $this-&gt;container-&gt;renderer-&gt;render($response, "product.view.php", compact('title', 'categorias', 'categoriasCached', 'producto', 'relacionados', 'loadProductoJson'));

</pre>
<p>Y modificamos <code>fin-doc.part.php</code> </p>
<pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="diff" contenteditable="false" cid="n147" mdtype="fences">@@ -24,6 +24,11 @@
 &lt;!-- Bootstrap Core JavaScript --&gt;
 &lt;script src="&lt;?=$basePath;?&gt;/js/bootstrap.min.js"&gt;&lt;/script&gt;
 &lt;script src="&lt;?=$basePath;?&gt;/js/app.js"&gt;&lt;/script&gt;
+&lt;?php if(($loadProductoJson ?? false)):?&gt;
+&lt;script&gt;
+loadProductoJson();
+&lt;/script&gt;
+&lt;?php endif ?&gt;
 &lt;/body&gt;
</pre>
<h3 id="heading-17">
<a name="header-n148" class="md-header-anchor "></a>Mejoras</h3>
<p>Como podéis observar, ahora ya no cambian los productos relacionados.</p>
<p>Así que os lo dejo como mejora.</p>
<hr>
<p><strong>Credits.</strong></p>
<p>Víctor Ponz <a href="mailto:victorponz@gmail.com" target="_blank" class="url">victorponz@gmail.com</a></p>
<p>Este material está licenciado bajo una licencia <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons, Attribution-NonCommercial-ShareAlike</a></p>
<p><img src="https://licensebuttons.net/l/by-nc-sa/3.0/88x31.png" alt="" referrerpolicy="no-referrer"></p>
<p> </p>
</div>      <div id='custom-footer'>
        <!--put here your custom footer -->
      </div>
    </div>
  </div><!--typora-export-->
</div><!--typora-container-->

<!-- jQuery first, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-1.8.3.min.js"></script>  
  <script type="text/javascript">
   'use strict';
// https://github.com/iamdustan/smoothscroll/edit/master/src/smoothscroll.js
// polyfill
function polyfill() {
  // aliases
  var w = window;
  var d = document;

  // return if scroll behavior is supported and polyfill is not forced
  if (
    'scrollBehavior' in d.documentElement.style &&
    w.__forceSmoothScrollPolyfill__ !== true
  ) {
    return;
  }

  // globals
  var Element = w.HTMLElement || w.Element;
  var SCROLL_TIME = 468;

  // object gathering original scroll methods
  var original = {
    scroll: w.scroll || w.scrollTo,
    scrollBy: w.scrollBy,
    elementScroll: Element.prototype.scroll || scrollElement,
    scrollIntoView: Element.prototype.scrollIntoView
  };

  // define timing method
  var now =
    w.performance && w.performance.now
      ? w.performance.now.bind(w.performance)
      : Date.now;

  /**
   * indicates if a the current browser is made by Microsoft
   * @method isMicrosoftBrowser
   * @param {String} userAgent
   * @returns {Boolean}
   */
  function isMicrosoftBrowser(userAgent) {
    var userAgentPatterns = ['MSIE ', 'Trident/', 'Edge/'];

    return new RegExp(userAgentPatterns.join('|')).test(userAgent);
  }

  /*
   * IE has rounding bug rounding down clientHeight and clientWidth and
   * rounding up scrollHeight and scrollWidth causing false positives
   * on hasScrollableSpace
   */
  var ROUNDING_TOLERANCE = isMicrosoftBrowser(w.navigator.userAgent) ? 1 : 0;

  /**
   * changes scroll position inside an element
   * @method scrollElement
   * @param {Number} x
   * @param {Number} y
   * @returns {undefined}
   */
  function scrollElement(x, y) {
    this.scrollLeft = x;
    this.scrollTop = y;
  }

  /**
   * returns result of applying ease math function to a number
   * @method ease
   * @param {Number} k
   * @returns {Number}
   */
  function ease(k) {
    return 0.5 * (1 - Math.cos(Math.PI * k));
  }

  /**
   * indicates if a smooth behavior should be applied
   * @method shouldBailOut
   * @param {Number|Object} firstArg
   * @returns {Boolean}
   */
  function shouldBailOut(firstArg) {
    if (
      firstArg === null ||
      typeof firstArg !== 'object' ||
      firstArg.behavior === undefined ||
      firstArg.behavior === 'auto' ||
      firstArg.behavior === 'instant'
    ) {
      // first argument is not an object/null
      // or behavior is auto, instant or undefined
      return true;
    }

    if (typeof firstArg === 'object' && firstArg.behavior === 'smooth') {
      // first argument is an object and behavior is smooth
      return false;
    }

    // throw error when behavior is not supported
    throw new TypeError(
      'behavior member of ScrollOptions ' +
        firstArg.behavior +
        ' is not a valid value for enumeration ScrollBehavior.'
    );
  }

  /**
   * indicates if an element has scrollable space in the provided axis
   * @method hasScrollableSpace
   * @param {Node} el
   * @param {String} axis
   * @returns {Boolean}
   */
  function hasScrollableSpace(el, axis) {
    if (axis === 'Y') {
      return el.clientHeight + ROUNDING_TOLERANCE < el.scrollHeight;
    }

    if (axis === 'X') {
      return el.clientWidth + ROUNDING_TOLERANCE < el.scrollWidth;
    }
  }

  /**
   * indicates if an element has a scrollable overflow property in the axis
   * @method canOverflow
   * @param {Node} el
   * @param {String} axis
   * @returns {Boolean}
   */
  function canOverflow(el, axis) {
    var overflowValue = w.getComputedStyle(el, null)['overflow' + axis];

    return overflowValue === 'auto' || overflowValue === 'scroll';
  }

  /**
   * indicates if an element can be scrolled in either axis
   * @method isScrollable
   * @param {Node} el
   * @param {String} axis
   * @returns {Boolean}
   */
  function isScrollable(el) {
    var isScrollableY = hasScrollableSpace(el, 'Y') && canOverflow(el, 'Y');
    var isScrollableX = hasScrollableSpace(el, 'X') && canOverflow(el, 'X');

    return isScrollableY || isScrollableX;
  }

  /**
   * finds scrollable parent of an element
   * @method findScrollableParent
   * @param {Node} el
   * @returns {Node} el
   */
  function findScrollableParent(el) {
    var isBody;

    do {
      el = el.parentNode;

      isBody = el === d.body;
    } while (isBody === false && isScrollable(el) === false);

    isBody = null;

    return el;
  }

  /**
   * self invoked function that, given a context, steps through scrolling
   * @method step
   * @param {Object} context
   * @returns {undefined}
   */
  function step(context) {
    var time = now();
    var value;
    var currentX;
    var currentY;
    var elapsed = (time - context.startTime) / SCROLL_TIME;

    // avoid elapsed times higher than one
    elapsed = elapsed > 1 ? 1 : elapsed;

    // apply easing to elapsed time
    value = ease(elapsed);

    currentX = context.startX + (context.x - context.startX) * value;
    currentY = context.startY + (context.y - context.startY) * value;

    context.method.call(context.scrollable, currentX, currentY);

    // scroll more if we have not reached our destination
    if (currentX !== context.x || currentY !== context.y) {
      w.requestAnimationFrame(step.bind(w, context));
    }
  }

  /**
   * scrolls window or element with a smooth behavior
   * @method smoothScroll
   * @param {Object|Node} el
   * @param {Number} x
   * @param {Number} y
   * @returns {undefined}
   */
  function smoothScroll(el, x, y) {
    var scrollable;
    var startX;
    var startY;
    var method;
    var startTime = now();

    // define scroll context
    if (el === d.body) {
      scrollable = w;
      startX = w.scrollX || w.pageXOffset;
      startY = w.scrollY || w.pageYOffset;
      method = original.scroll;
    } else {
      scrollable = el;
      startX = el.scrollLeft;
      startY = el.scrollTop;
      method = scrollElement;
    }

    // scroll looping over a frame
    step({
      scrollable: scrollable,
      method: method,
      startTime: startTime,
      startX: startX,
      startY: startY,
      x: x,
      y: y
    });
  }

  // ORIGINAL METHODS OVERRIDES
  // w.scroll and w.scrollTo
  w.scroll = w.scrollTo = function() {
    // avoid action when no arguments are passed
    if (arguments[0] === undefined) {
      return;
    }

    // avoid smooth behavior if not required
    if (shouldBailOut(arguments[0]) === true) {
      original.scroll.call(
        w,
        arguments[0].left !== undefined
          ? arguments[0].left
          : typeof arguments[0] !== 'object'
            ? arguments[0]
            : w.scrollX || w.pageXOffset,
        // use top prop, second argument if present or fallback to scrollY
        arguments[0].top !== undefined
          ? arguments[0].top
          : arguments[1] !== undefined
            ? arguments[1]
            : w.scrollY || w.pageYOffset
      );

      return;
    }

    // LET THE SMOOTHNESS BEGIN!
    smoothScroll.call(
      w,
      d.body,
      arguments[0].left !== undefined
        ? ~~arguments[0].left
        : w.scrollX || w.pageXOffset,
      arguments[0].top !== undefined
        ? ~~arguments[0].top
        : w.scrollY || w.pageYOffset
    );
  };

  // w.scrollBy
  w.scrollBy = function() {
    // avoid action when no arguments are passed
    if (arguments[0] === undefined) {
      return;
    }

    // avoid smooth behavior if not required
    if (shouldBailOut(arguments[0])) {
      original.scrollBy.call(
        w,
        arguments[0].left !== undefined
          ? arguments[0].left
          : typeof arguments[0] !== 'object' ? arguments[0] : 0,
        arguments[0].top !== undefined
          ? arguments[0].top
          : arguments[1] !== undefined ? arguments[1] : 0
      );

      return;
    }

    // LET THE SMOOTHNESS BEGIN!
    smoothScroll.call(
      w,
      d.body,
      ~~arguments[0].left + (w.scrollX || w.pageXOffset),
      ~~arguments[0].top + (w.scrollY || w.pageYOffset)
    );
  };

  // Element.prototype.scroll and Element.prototype.scrollTo
  Element.prototype.scroll = Element.prototype.scrollTo = function() {
    // avoid action when no arguments are passed
    if (arguments[0] === undefined) {
      return;
    }

    // avoid smooth behavior if not required
    if (shouldBailOut(arguments[0]) === true) {
      // if one number is passed, throw error to match Firefox implementation
      if (typeof arguments[0] === 'number' && arguments[1] === undefined) {
        throw new SyntaxError('Value could not be converted');
      }

      original.elementScroll.call(
        this,
        // use left prop, first number argument or fallback to scrollLeft
        arguments[0].left !== undefined
          ? ~~arguments[0].left
          : typeof arguments[0] !== 'object' ? ~~arguments[0] : this.scrollLeft,
        // use top prop, second argument or fallback to scrollTop
        arguments[0].top !== undefined
          ? ~~arguments[0].top
          : arguments[1] !== undefined ? ~~arguments[1] : this.scrollTop
      );

      return;
    }

    var left = arguments[0].left;
    var top = arguments[0].top;

    // LET THE SMOOTHNESS BEGIN!
    smoothScroll.call(
      this,
      this,
      typeof left === 'undefined' ? this.scrollLeft : ~~left,
      typeof top === 'undefined' ? this.scrollTop : ~~top
    );
  };

  // Element.prototype.scrollBy
  Element.prototype.scrollBy = function() {
    // avoid action when no arguments are passed
    if (arguments[0] === undefined) {
      return;
    }

    // avoid smooth behavior if not required
    if (shouldBailOut(arguments[0]) === true) {
      original.elementScroll.call(
        this,
        arguments[0].left !== undefined
          ? ~~arguments[0].left + this.scrollLeft
          : ~~arguments[0] + this.scrollLeft,
        arguments[0].top !== undefined
          ? ~~arguments[0].top + this.scrollTop
          : ~~arguments[1] + this.scrollTop
      );

      return;
    }

    this.scroll({
      left: ~~arguments[0].left + this.scrollLeft,
      top: ~~arguments[0].top + this.scrollTop,
      behavior: arguments[0].behavior
    });
  };

  // Element.prototype.scrollIntoView
  Element.prototype.scrollIntoView = function() {
    // avoid smooth behavior if not required
    if (shouldBailOut(arguments[0]) === true) {
      original.scrollIntoView.call(
        this,
        arguments[0] === undefined ? true : arguments[0]
      );

      return;
    }

    // LET THE SMOOTHNESS BEGIN!
    var scrollableParent = findScrollableParent(this);
    var parentRects = scrollableParent.getBoundingClientRect();
    var clientRects = this.getBoundingClientRect();

    if (scrollableParent !== d.body) {
      // reveal element inside parent
      smoothScroll.call(
        this,
        scrollableParent,
        scrollableParent.scrollLeft + clientRects.left - parentRects.left,
        scrollableParent.scrollTop + clientRects.top - parentRects.top
      );

      // reveal parent in viewport unless is fixed
      if (w.getComputedStyle(scrollableParent).position !== 'fixed') {
        w.scrollBy({
          left: parentRects.left,
          top: parentRects.top,
          behavior: 'smooth'
        });
      }
    } else {
      // reveal element in viewport
      w.scrollBy({
        left: clientRects.left,
        top: clientRects.top,
        behavior: 'smooth'
      });
    }
  };
}

if (typeof exports === 'object' && typeof module !== 'undefined') {
  // commonjs
  module.exports = { polyfill: polyfill };
} else {
  // global
  polyfill();
}
  </script>

<script type="text/javascript">
let previous;
let t = "";
let allHeadings = $("h1, h2, h3, h4, h5, h6");
for (idx = 0; idx < allHeadings.length; idx++) {
    let o = allHeadings.get(idx);
    let next;
    
    if (allHeadings.get(idx+1)){
      next = $(allHeadings.get(idx+1)).find("a")
    }
    if (next){
      $(o).attr("data-next", next.attr("name"));
    }else{
      $(o).attr("data-next", "");
    }
    if (previous){
      $(o).attr("data-previous", previous.attr("name"));
    }else{
      $(o).attr("data-previous", "");
    }
    previous = $(o).find("a");
   
}
$('.top .toogle').click(
  e=>{
    e.preventDefault();
      let el = $(e.currentTarget);
      if (el.hasClass('expanded')){
        $('.typora-container').addClass('hide-menu');
      }else{
        $('.typora-container').removeClass('hide-menu');
      }
      el.toggleClass('expanded');
    }
);
$(".md-toc-content a").click(e =>{
  e.preventDefault();
  let el = $(e.currentTarget);
  $(".md-toc-content a").removeClass("active");
  el.addClass("active");
  
    let destination = document.querySelector("[name='" + e.currentTarget.href.split("#")[1] + "']");
    destination.scrollIntoView({ behavior: 'smooth' })
    //Hacerlo con una promesa
    window.setTimeout(() =>location.hash = e.currentTarget.href.split("#")[1],500);
  
}); 
$("#nav-previous, #nav-next").click(e =>{
  

  let el = $(e.currentTarget);
  let name =  e.currentTarget.href.split("#")[1];
  if (name !== "")
    location.hash = name;;

});

function isAnyPartOfElementInViewport(el) {

const rect = el.getBoundingClientRect();
// DOMRect { x: 8, y: 8, width: 100, height: 100, top: 8, right: 108, bottom: 108, left: 8 }
const windowHeight = (window.innerHeight || document.documentElement.clientHeight);
const windowWidth = (window.innerWidth || document.documentElement.clientWidth);

// http://stackoverflow.com/questions/325933/determine-whether-two-date-ranges-overlap
const vertInView = (rect.top <= windowHeight) && ((rect.top + rect.height) >= 0);
const horInView = (rect.left <= windowWidth) && ((rect.left + rect.width) >= 0);

return (vertInView && horInView);
}
let lastScrollTop = 0;
let lastActive;
window.addEventListener('keydown', function(e) {
  let name = null;
  if (e.keyCode == 39){
    location.hash = $('#nav-next').attr("href");
    name =  $('#nav-next').attr("href").split("#")[1];
  }else if(e.keyCode == 37){
    location.hash = $('#nav-previous').attr("href");
    name =  $('#nav-previous').attr("href").split("#")[1];
  }else{
    return;
  }
});
let writeEl = document.querySelector("#write");

window.onload = function(){
  function getAnchor() {
    var currentUrl = document.URL,
	  urlParts   = currentUrl.split('#');
		
    return (urlParts.length > 1) ? urlParts[1] : null;
  }
  let anchor = getAnchor();
  let curTocEl = $("[href=" + anchor + "]")
  if (curTocEl)
    curTocEl.addClass("active");

}

window.addEventListener('scroll', function(e) {
  var st = window.pageYOffset || document.documentElement.scrollTop; // Credits: "https://github.com/qeremy/so/blob/master/so.dom.js#L426"
   if (st > lastScrollTop){
    $("h1, h2, h3, h4, h5, h6").each(
    function()
    {
        if (isAnyPartOfElementInViewport(this)){
          let el = $(this);
          $('#nav-previous').attr("href", "#" + el.attr("data-previous"));
          $('#nav-next').attr("href", "#" + el.attr("data-next"));
          $('.typora-menu').find( "a").removeClass('active');
          lastActive = $('.typora-menu').find( "#anchor-" + el.attr('id'));
          lastActive.addClass('active');
          if (!isAnyPartOfElementInViewport(lastActive[0])){
            lastActive[0].scrollIntoView();
          }
          return false;
        }
    } 
  );
   } else {
    let notFound = true; 
    $("h1, h2, h3, h4, h5, h6").each(
    function()
    {
        if (isAnyPartOfElementInViewport(this)){
          let el = $(this);
          $('#nav-previous').attr("href", "#" + el.attr("data-previous"));
          $('#nav-next').attr("href", "#" + el.attr("data-next"));
          notFound = false;
          $('.typora-menu').find( "a").removeClass('active');
          lastActive = $('.typora-menu').find( "#anchor-" + el.attr('id'));
          lastActive.addClass('active');
          if (!isAnyPartOfElementInViewport(lastActive[0])){
            lastActive[0].scrollIntoView();
          }
          return false;
        }
      
    } 
  );
    if (notFound){
      $('.typora-menu').find( "a").removeClass('active');
      if (lastActive){
        let lastId = lastActive.attr("id").split("-")[2] - 1;
        let t = $('.typora-menu').find( "#anchor-heading-" + lastId);
        if (t){
          t.addClass('active');
          if (!isAnyPartOfElementInViewport(t[0])){
              t[0].scrollIntoView();
              $('#nav-previous').attr("href", "#" + t.attr("data-previous"));
              $('#nav-next').attr("href", "#" + t.attr("data-next"));
            }
          
        }
      }

    }
   }
   lastScrollTop = st <= 0 ? 0 : st; // For Mobile or negative scrolling
  
});

let codeMirrors = $('.CodeMirror-code');
codeMirrors.each(function(){
	let lines = $(this).find('pre > span');
	let code = "";
	lines.each(function(){
		let line = $(this);
		line.html(line.html().replace(/[\u0250-\ue007]/g, ''));
		let spans =  line.find("span");
		spans.each(function(){
			let span = $(this);
			span.text(span.text().replace(/[\u0250-\ue007]/g, ''));
		});
			
	});
}
);

</script>
</body>
</html>
